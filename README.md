# keras_sample

## このリポジトリについて
Kerasを利用しCNN（Convolutional Neural Network）を使った画像の分類を行うための最小のサンプルです。

## 前提条件

### 動作環境

- Python 3.6.6
- tensorflow 1.12.0
- Keras 2.2.4

####  その他
ライブラリは必要に応じてインストールする

### CPU or GPU
本サンプルはCPUでも利用可能な簡単なものです。  
またGPUでもそのまま使う事は可能です。

GPUを使う事で訓練の精度は向上する事が予想されますが  
実際に試してはいません。  (2018/12/27 現在)

## サンプルの処理の内容

### 分類の種類について
分類するの以下の三種類の動物の画像です。

- panda(パンダ)
- cat(キャット)
- penguin(ペンギン)

直下にある上記のディレクトリに200枚以上のそれぞれのjpg画像を素材として用意してください。

該当するコードを書き換えれば任意のものに変更可能です。  
現在のバージョンでは設定ファイルが無いので以下の部分で変更が必要です。

```
classes = ["panda", "cat", "penguin"]
```

## 訓練の準備
各ディレクトリに画像を用意し以下を実行

```
python sample_generate.py
```

以下のファイルが生成されます。 
```
ani.npy
```
これは訓練用に画像データをNumpy形式に変更したものです。

## 訓練
各ディレクトリに画像を用意し以下を実行
```
python sample_cnn.py
```

訓練とテストが実行され以下のファイルが生成されます。

x_train.shapeでNumpy配列が配列形式になる
例）50 * 50 * 3  のデータが450個あるとすると
(450, 50, 50, 3)
となる個数は情報として不要なので

x_train.shape[1:]
(50, 50, 3)
model.fitで渡す必要なのはこの形式


```
sample_cnn.h5
```

これはCNNのネットワークと訓練した重みを含めたデータになります。

## 予測

```
python XXX.jpg(対象の画像ファイルのPath) ./sample_cnn.h5
```

以下の様な形式で結果が返ってきます。

```
(高い確率のカテゴリ名), 確率：XXX %(最も高い確率)
```

例) penguin の確率が最も高い場合
```
penguin, 確率：100 %
```




